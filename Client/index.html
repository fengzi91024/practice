<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>首页</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
      table {
        width: 800px;
        height: 150px;
        margin: 150px auto;
      }
      thead {
        background-color: #3f87a6;
        color: #fff;
      }
      tbody {
        background-color: #e4f0f5;
      }
      tbody td {
        text-align: center;
      }
      thead th:nth-last-child(1) {
        width: 120px;
      }
      table a {
        color: black;
        text-decoration: none;
      }
      table a:hover {
        color: red;
      }
    </style>
  </head>
  <body>
    <div id="root">
      <table>
        <thead>
          <tr>
            <th>id</th>
            <th>用户名</th>
            <th>性别</th>
            <th>手机号</th>
            <th>密码</th>
            <th>账号状态</th>
            <th>注册时间</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody id="list"></tbody>
      </table>
    </div>

   
    <script>
      //获取根标签
      const root = document.getElementById("root");
      //获取tbody
      const list = document.getElementById("list");

      //获取服务器发来的请求
      (async (cb) => {
        try {
          const res = await axios({
            method: "get",
            url: "http://127.0.0.1:4000/users",
          });
          console.log(res.data);
          cb(res.data.data);
        } catch (error) {
          console.log(error, "获取数据失败");
        }
      })(handleData);

      //处理数据
      function handleData(Arr) {
        for (let index = 0; index < Arr.length; index++) {
          const element = Arr[index];
          const { id, username, password, user_type, createdAt } = element;
          const state = "1";
          //创建tr标签
          const tr = document.createElement("tr");

          let userState = "启用";
          //判断用户状态 禁用和启用
          if (state !== "1") {
            userState = "禁用";
          }

          const date = Intl.DateTimeFormat("zh-CN").format(new Date(createdAt));

          //插入数据
          tr.insertAdjacentHTML(
            "afterbegin",
            `<td>${id}</td><td>${username}</td><td>男</td><td>${user_type}</td><td>${password}</td>
                  <td>${userState}</td><td>${date}</td>
                  <td><a href="./index.html" class="delete-link">删除</a> <a href="./index.html" class="update-link">修改</a></td>
                  `
          );

          //将数据插入表格中
          list.appendChild(tr);
        }

        list.addEventListener("click", function (event) {
          event.preventDefault(); //阻止默认行为
          //判断是否点击删除按钮
          if (event.target.classList.contains("delete-link")) {
            const check = window.confirm("是否删除该元素");

            //判断是否删除
            if (check !== false) {
              axios({
                method: "delete",
                url: "http://127.0.0.1:4000/delete",
              })
                .then((result) => {
                  const del = event.target.closest("tr");
                  del.remove();
                })
                .catch((err) => {});
            }
          }

          if (event.target.classList.contains("update-link")) {
            //判断是否点击更新
            if (event.target.classList.contains("update-link")) {
            }
          }
        });
      }
    </script>
  </body>
</html>
